<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>

    <!-- A-Frame + MindAR -->
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <!-- Poppins (for troika-text) -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;700&display=swap" rel="stylesheet">
    <!-- Troika text for true webfonts in A-Frame (adds, doesnâ€™t replace) -->
    <script src="https://unpkg.com/troika-three-text@0.49.0/dist/troika-three-text.min.js"></script>
    <script src="https://unpkg.com/aframe-troika-text/dist/aframe-troika-text.min.js"></script>

    <style>
      html, body { margin:0; padding:0; height:100%; }
      .example-container { position:absolute; inset:0; overflow:hidden; }

      /* Vertical (portrait) scanning overlay for a vertical card */
      #example-scanning-overlay{
        display:flex; align-items:center; justify-content:center;
        position:absolute; inset:0; background:transparent; z-index:2;
      }
      #example-scanning-overlay.hidden{ display:none; }
      #example-scanning-overlay .inner{
        position:relative; display:flex; align-items:center; justify-content:center;
        width:42vw; height:72vh; max-width:360px; max-height:720px;
        background:
          linear-gradient(to right, white 8px, transparent 8px) 0 0,
          linear-gradient(to right, white 8px, transparent 8px) 0 100%,
          linear-gradient(to left,  white 8px, transparent 8px) 100% 0,
          linear-gradient(to left,  white 8px, transparent 8px) 100% 100%,
          linear-gradient(to bottom, white 8px, transparent 8px) 0 0,
          linear-gradient(to bottom, white 8px, transparent 8px) 100% 0,
          linear-gradient(to top,    white 8px, transparent 8px) 0 100%,
          linear-gradient(to top,    white 8px, transparent 8px) 100% 100%;
        background-repeat:no-repeat; background-size:36px 36px;
      }
      #example-scanning-overlay .scanline{
        position:absolute; left:0; width:100%; height:8px; background:white; opacity:0.75;
        animation:scan 2s linear infinite;
      }
      @keyframes scan{ 0%,100%{ top:0% } 50%{ top:calc(100% - 8px) } }
    </style>

    <script>
      // Reveal now also emits 'show' to all children so their animations fire.
      function reveal(ids){
        ids.forEach(id=>{
          const el = document.querySelector(id);
          if(!el) return;
          el.setAttribute('visible', true);
          el.emit('show');
          el.querySelectorAll('*').forEach(child=>{
            if (child.emit) child.emit('show');
          });
        });
      }
      function conceal(ids){
        ids.forEach(id=>{
          const el = document.querySelector(id);
          if(!el) return;
          el.setAttribute('visible', false);
        });
      }
      const openNew = (url)=> window.open(url, '_blank');

      AFRAME.registerComponent('mytarget', {
        init: function (){
          const el = this.el;

          // Clickable social icons
          [['#icon-insta','https://instagram.com/'],
           ['#icon-linkedin','https://www.linkedin.com/'],
           ['#icon-discord','https://discord.com/invite/'],
           ['#icon-whatsapp','https://wa.me/']]
          .forEach(([sel,url])=>{
            const node = document.querySelector(sel);
            if(node) node.addEventListener('click', ()=>openNew(url));
          });

          el.addEventListener('targetFound', ()=>{
            reveal(['#icons-group','#rightcol-group','#model-group']);
            // Play video when marker is found
            const vid = document.querySelector('#right-video');
            if(vid) vid.play();
            // also fade-in troika texts
            const th = document.querySelector('#troika-heading');
            const ts = document.querySelector('#troika-subtitle');
            if (th) th.emit('show');
            if (ts) ts.emit('show');
          });
          el.addEventListener('targetLost', ()=>{
            conceal(['#icons-group','#rightcol-group','#model-group']);
            // Pause video when marker is lost
            const vid = document.querySelector('#right-video');
            if(vid) vid.pause();
          });
        }
      });

      // Configurable GLB scale & rotation
      const MODEL_SCALE = {x: 1, y: 1, z: 1};
      const MODEL_ROTATION = {x: 45, y: -50, z:40};
      const SPIN_DURATION = 12000; // ms for full rotation

      document.addEventListener("DOMContentLoaded", ()=>{
        const model = document.querySelector("#mini-model");
        if(model){
          model.setAttribute("scale", `${MODEL_SCALE.x} ${MODEL_SCALE.y} ${MODEL_SCALE.z}`);
          model.setAttribute("rotation", `${MODEL_ROTATION.x} ${MODEL_ROTATION.y} ${MODEL_ROTATION.z}`);
          model.setAttribute("animation__spin", 
            `property: rotation; to: 0 360 0; loop: true; dur: ${SPIN_DURATION}; easing: linear`);
        }
      });
    </script>
  </head>

  <body>
    <div class="example-container">
      <!-- Portrait scanner frame -->
      <div id="example-scanning-overlay" class="hidden">
        <div class="inner"><div class="scanline"></div></div>
      </div>

      <!-- Keep your working MindAR smoothing values -->
      <a-scene
        mindar-image="imageTargetSrc: ./assets/targets.mind; showStats: false; uiScanning: #example-scanning-overlay; filterMinCF: 0.1; filterBeta: 10; warmupTolerance: 3; missTolerance: 3;"
        embedded
        color-space="sRGB"
        renderer="colorManagement: true, physicallyCorrectLights, antialias: true"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">

        <!-- Mouse ray for clicking -->
        <a-camera position="0 0 0"
                  look-controls="enabled: false"
                  cursor="fuse: false; rayOrigin: mouse;"
                  raycaster="far: 10000; objects: .clickable">
        </a-camera>

        <!-- Assets: white PNG icons + video + your GLB -->
        <a-assets>
          <!-- White icons (reliable PNGs) -->
          <img id="igw" crossorigin="anonymous" src="https://img.icons8.com/ios-filled/100/FFFFFF/instagram-new.png">
          <img id="liw" crossorigin="anonymous" src="https://img.icons8.com/ios-filled/100/FFFFFF/linkedin.png">
          <img id="dcw" crossorigin="anonymous" src="https://img.icons8.com/ios-filled/100/FFFFFF/discord-logo.png">
          <img id="waw" crossorigin="anonymous" src="https://img.icons8.com/ios-filled/100/FFFFFF/whatsapp.png">

          <!-- Right-side image (kept for fallback) -->
          <img id="side-photo" src="./assets/imagetotrack.png">

          <!-- Right-side video -->
          <video id="right-video"
                 src="./assets/right.mp4"
                 loop
                 muted
                 playsinline
                 webkit-playsinline
                 crossorigin="anonymous"></video>

          <!-- Your GLB -->
          <a-asset-item id="userModel" src="./assets/light_bulb.glb"></a-asset-item>
        </a-assets>

        <!-- Lights -->
        <a-entity light="type: ambient; intensity: 1.0"></a-entity>
        <a-entity light="type: directional; intensity: 0.9" position="1 2 1"></a-entity>

        <!-- Anchor to first target -->
        <a-entity id="mytarget" mytarget mindar-image-target="targetIndex: 0">

          <!-- 1) ICONS (more spacing left/right + lower) -->
          <a-entity id="icons-group" visible="false" position="0 -1.30 0.001"
                    animation__fade="property: scale; from: 0 0 0; to: 1 1 1; dur: 700; easing: easeOutCubic; startEvents: show">
            <a-image id="icon-insta" class="clickable"
                     src="#igw" scale="1.4 1.4 1"
                     position="-0.60 0 0" width="0.20" height="0.20" opacity="0.95"
                     animation__pulse="property: scale; to: 1.1 1.1 1; dir: alternate; loop: true; dur: 1200; easing: easeInOutQuad">
            </a-image>

            <a-image id="icon-linkedin" class="clickable"
                     src="#liw" scale="1.4 1.4 1"
                     position="-0.20 0 0" width="0.20" height="0.20" opacity="0.95"
                     animation__pulse="property: scale; to: 1.1 1.1 1; dir: alternate; loop: true; dur: 1200; easing: easeInOutQuad; delay:100">
            </a-image>

            <a-image id="icon-discord" class="clickable"
                     src="#dcw" scale="1.4 1.4 1"
                     position="0.20 0 0" width="0.20" height="0.20" opacity="0.95"
                     animation__pulse="property: scale; to: 1.1 1.1 1; dir: alternate; loop: true; dur: 1200; easing: easeInOutQuad; delay:200">
            </a-image>

            <a-image id="icon-whatsapp" class="clickable"
                     src="#waw" scale="1.4 1.4 1"
                     position="0.60 0 0" width="0.20" height="0.20" opacity="0.95"
                     animation__pulse="property: scale; to: 1.1 1.1 1; dir: alternate; loop: true; dur: 1200; easing: easeInOutQuad; delay:300">
            </a-image>
          </a-entity>

          <!-- 2) RIGHT COLUMN (further left to increase separation from model) -->
          <a-entity id="rightcol-group" visible="false" position="0.30 0 -0.02"
                    animation__fade="property: scale; from: 0.9 0.9 0.9; to: 1 1 1; dur: 600; easing: easeOutCubic; startEvents: show">

            <a-image id="right-photo"
                     src="#side-photo"
                     position="0 0.45 0" width="0.60" height="0.76"
                     material="transparent:true; opacity:0"
                     animation__in="property: material.opacity; from: 0; to: 1; dur: 600; easing: easeOutCubic; startEvents: show">
            </a-image>

            <!-- CROPPED/ZOOOMED VIDEO: wider+shorter plane + UV zoom/offset to remove letterbox -->
            <a-video id="right-video-entity"
                     src="#right-video"
                     position="0.45 0.45 0"
                     width="1.00"            <!-- larger video for prominence -->
                     height="0.56"           <!-- keep ~16:9 aspect-ish -->
                     material="shader: flat; src: #right-video; transparent: true; opacity: 0; repeat: 1.6 1.6; offset: -0.30 -0.15"
                     animation__in="property: material.opacity; from: 0; to: 1; dur: 600; easing: easeOutCubic; startEvents: show">
            </a-video>

            <!-- Your original A-Frame texts (kept intact) -->
            <a-text id="heading"
                    value="Making Ideas like this Happen, but how?"
                    color="#FFFFFF"
                    align="left"
                    width="2.2"
                    position="0  -0.45 0"
                    anchor="left"
                    opacity="0"
                    letter-spacing="2"
                    wrap-count="22"
                    animation__in="property: opacity; from: 0; to: 1; dur: 600; delay: 120; easing: easeOutCubic; startEvents: show">
            </a-text>

            <a-text id="subtitle"
                    value="Click on the icons to learn more about us!"
                    color="#EEEEEE"
                    align="left"
                    width="2.2"
                    position="0  -0.95 0"
                    anchor="left"
                    opacity="0"
                    wrap-count="28"
                    animation__in="property: opacity; from: 0; to: 1; dur: 600; delay: 240; easing: easeOutCubic; startEvents: show">
            </a-text>

            <!-- NEW Troika text using Poppins (added; originals preserved) -->
            <a-entity id="troika-heading"
                      troika-text="value: Making Ideas like this Happen, but how?;
                                   anchor: left; maxWidth: 1.8; color: #FFFFFF; fontSize: 0.08;
                                   font: https://fonts.gstatic.com/s/poppins/v20/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2;"
                      position="0 -0.40 0"
                      visible="true"
                      opacity="0"
                      animation__in="property: opacity; from: 0; to: 1; dur: 600; delay: 100; easing: easeOutCubic; startEvents: show">
            </a-entity>

            <a-entity id="troika-subtitle"
                      troika-text="value: Click on the icons to learn more about us!;
                                   anchor: left; maxWidth: 1.8; color: #DDDDDD; fontSize: 0.06;
                                   font: https://fonts.gstatic.com/s/poppins/v20/pxiEyp8kv8JHgFVrJJLucXtAKPY.woff2;"
                      position="0 -0.90 0"
                      visible="true"
                      opacity="0"
                      animation__in="property: opacity; from: 0; to: 1; dur: 600; delay: 220; easing: easeOutCubic; startEvents: show">
            </a-entity>
          </a-entity>

          <!-- 3) 3D MODEL (pushed further right & down for maximum separation) -->
          <a-entity id="model-group" visible="false" position="2.00 -1.50 -0.03"
                    animation__fade="property: scale; from: 0 0 0; to: 1 1 1; dur: 800; easing: easeOutCubic; startEvents: show">
            <a-gltf-model id="mini-model"
                          src="#userModel"
                          position="0 0 0"
                          scale="0.28 0.28 0.28"
                          rotation="0 0 0">
            </a-gltf-model>
          </a-entity>

        </a-entity>
      </a-scene>
    </div>
  </body>
</html>
